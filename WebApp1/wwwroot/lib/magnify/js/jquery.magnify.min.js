/*!
 * jQuery Magnify Plugin v2.3.3 by T. H. Doan (https://thdoan.github.io/magnify/)
 * Based on http://thecodeplayer.com/walkthrough/magnifying-glass-for-images-using-jquery-and-css3
 *
 * jQuery Magnify by T. H. Doan is licensed under the MIT License.
 * Read a copy of the license in the LICENSE file or at https://choosealicense.com/licenses/mit/
 */
(function(n){n.fn.magnify=function(t){t=n.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},t);var i=this,u=n("html"),e=function(i){var f=n(i),w=f.closest("a"),e={},et,b,h;for(et in t)e[et]=f.attr("data-magnify-"+et.toLowerCase());if(b=e.src||t.src||w.attr("href")||"",b){var s,o,p,a,c,l,k,d,nt=0,tt=0,it,rt,v,y,ut,g,ot=function(){var n=s.offset();return g={top:f.offset().top-n.top+parseInt(f.css("border-top-width"))+parseInt(f.css("padding-top")),left:f.offset().left-n.left+parseInt(f.css("border-left-width"))+parseInt(f.css("padding-left"))},n.top+=g.top,n.left+=g.left,n},ft=function(){o.is(":visible")&&o.fadeOut(t.speed,function(){u.removeClass("magnifying").trigger("magnifyend")})},st=function(n){var s,i,e,h,w;if(!a){r();return}n?(n.preventDefault(),it=n.pageX||n.originalEvent.touches[0].pageX,rt=n.pageY||n.originalEvent.touches[0].pageY,f.data("lastPos",{x:it,y:rt})):(it=f.data("lastPos").x,rt=f.data("lastPos").y);v=it-ut.left;y=rt-ut.top-t.touchBottomOffset;o.is(":animated")||(v>nt&&v<p-nt&&y>tt&&y<a-tt?o.is(":hidden")&&(u.addClass("magnifying").trigger("magnifystart"),o.fadeIn(t.speed)):ft());o.is(":visible")&&(s="",c&&l&&(i=-Math.round(v/p*c-k/2),e=-Math.round(y/a*l-d/2),t.limitBounds&&(h=-Math.round((p-nt)/p*c-k/2),w=-Math.round((a-tt)/a*l-d/2),i>0?i=0:i<h&&(i=h),e>0?e=0:e<w&&(e=w)),s=i+"px "+e+"px"),o.css({top:Math.round(y-d/2)+g.top+"px",left:Math.round(v-k/2)+g.left+"px","background-position":s}))};isNaN(+e.speed)||(t.speed=+e.speed);isNaN(+e.timeout)||(t.timeout=+e.timeout);isNaN(+e.finalWidth)||(t.finalWidth=+e.finalWidth);isNaN(+e.finalHeight)||(t.finalHeight=+e.finalHeight);isNaN(+e.magnifiedWidth)||(t.magnifiedWidth=+e.magnifiedWidth);isNaN(+e.magnifiedHeight)||(t.magnifiedHeight=+e.magnifiedHeight);e.limitBounds==="true"&&(t.limitBounds=!0);typeof window[e.afterLoad]=="function"&&(t.afterLoad=window[e.afterLoad]);/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+e.touchBottomOffset)||(t.touchBottomOffset=+e.touchBottomOffset):t.touchBottomOffset=0;f.data("originalStyle",f.attr("style"));h=new Image;n(h).on({load:function(){var i,r;f.css("display","block");f.parent(".magnify").length||f.wrap('<div class="magnify"><\/div>');s=f.parent(".magnify");f.prev(".magnify-lens").length?s.children(".magnify-lens").css("background-image","url('"+b+"')"):f.before('<div class="magnify-lens loading" style="background:url(\''+b+"') 0 0 no-repeat\"><\/div>");o=s.children(".magnify-lens");o.removeClass("loading");p=t.finalWidth||f.width();a=t.finalHeight||f.height();c=t.magnifiedWidth||h.width;l=t.magnifiedHeight||h.height;k=o.width();d=o.height();ut=ot();t.limitBounds&&(nt=k/2/(c/p),tt=d/2/(l/a));(c!==h.width||l!==h.height)&&o.css("background-size",c+"px "+l+"px");f.data("zoomSize",{width:c,height:l});s.data("mobileCloseEvent",e.mobileCloseEvent||t.mobileCloseEvent);h=null;t.afterLoad();o.is(":visible")&&st();s.off().on({"mousemove touchmove":st,mouseenter:function(){ut=ot()},mouseleave:ft});if(t.timeout>=0)s.on("touchend",function(){setTimeout(ft,t.timeout)});n("body").not(s).on("touchstart",ft);i=f.attr("usemap");i&&(r=n("map[name="+i.slice(1)+"]"),f.after(r),s.click(function(t){if(t.clientX||t.clientY){o.hide();var i=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY);i.nodeName==="AREA"?i.click():n("area",r).each(function(){var t=n(this).attr("coords").split(",");if(v>=t[0]&&v<=t[2]&&y>=t[1]&&y<=t[3])return this.click(),!1})}}));w.length&&(w.css("display","inline-block"),!w.attr("href")||e.src||t.src||w.click(function(n){n.preventDefault()}))},error:function(){h=null}});h.src=b}},f=0,r=function(){clearTimeout(f);f=setTimeout(function(){i.destroy();i.magnify(t)},100)};return this.destroy=function(){return this.each(function(){var t=n(this),i=t.prev("div.magnify-lens"),r=t.data("originalStyle");t.parent("div.magnify").length&&i.length&&(r?t.attr("style",r):t.removeAttr("style"),t.unwrap(),i.remove())}),n(window).off("resize",r),i},n(window).resize(r),this.each(function(){e(this)})}})(jQuery);